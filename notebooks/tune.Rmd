---
title: "tune"
author: "Jin"
date: "2021年5月14日"
output: html_document
---

- Set working directory
```{r setup}
your.wd <- "/home/jinyunfan/Documents/bioinfo/exRNA/ez-prediction"
knitr::opts_knit$set(root.dir = your.wd)
```

- Perform hyper-parameter tuning. Using logistic regression and leave one out  validation as an example

- Load glmnet and pROC package
```{R}
library(glmnet)
```
- Load data
```{R}
sample.info <- read.table("metadata/dataset.split.txt", header = T, sep ="\t",row.names=1,stringsAsFactors = F,check.names = F)
exp.mat <- read.table("output/processed/log.cpm.scaled.txt", header = T, sep ="\t",row.names=1,stringsAsFactors = F,check.names = F)
exp.mat <- as.matrix(exp.mat)
train.ids <- rownames(sample.info)[sample.info$dataset=="train"]
selected.features <- read.table("output/features/de.train.txt", header = T, sep ="\t",row.names=1,stringsAsFactors = F,check.names = F)
feature.ids <- rownames(selected.features)[1:50]
exp.mat <- exp.mat[feature.ids,train.ids]
exp.mat <- t(as.matrix(exp.mat))
labels <- sample.info[train.ids,"tissue.types"]
labels <- factor(labels,level=c("normal","tumor"))
labels <- as.integer(labels) - 1
```
- Perform LOO cross validation
```{R}
cv.result <- cv.glmnet(exp.mat,labels,family="binomial",nfolds = length(labels))
plot(cv.result$lambda,cv.result$cvm)
cv.result$lambda.min
```